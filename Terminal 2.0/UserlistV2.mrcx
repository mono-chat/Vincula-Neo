;;;Userlist V2 by Sky;;

;;;;;Event's

on *:LOAD:{
  ;oldvers check
  if ($exists(Lists.ini)) { remove Lists.ini }
  writeini -n Userlist.ini Global Halted False
}

alias enum_level {
  if ($1 == b) { return 1 }
  if ($1 == k) { return 2 }
  if ($1 == v) { return 3 }
  if ($1 == o) { return 4 }
  if ($1 == q) { return 5 }
  else return 0
}

on *:JOIN:#:{
  if ($GetGlobalStatus == False) {
    if ($IsGlobal($ial($nick).addr) == True) {
      var %level = $GetLevel(Global,$ial($nick).addr)
      if (%level == o) && ($IsHalted(#,#) == True) { halt }
      if (%level == o) && ($IsChan(#,$ial($nick).addr) == True) && ($IsHalted(#,#) != True) { 
        if ($enum_level($GetLevel(#,$ial($nick).addr)) > $enum_level(%level)) goto localaop
      }
      var %comment = $GetComment(Global,$ial($nick).addr)
      if (%level == o) && ($nick isowner #) { halt }
      if (%level == b) {
        if ($IsHalted(#,#) == True) { halt }
        elseif ($IsHalted(Global,$ial($nick).addr) != False) { halt }
      }
      if (%level != k) && (%level != b) {
        msg # Global %level User $nick ( $+ %comment $+ )
        if ($me isop #) && ($me !isowner #) && (%level == q) {
          $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove(#,$chr(37)) $nick o
          halt
        }
        $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove(#,$chr(37)) $nick %level
        sockwrite -tn $hget(channels,#) MODE # %level $nick
      }
      elseif (%level == k) {
        sockwrite $hget(channels,#) $+(kick # $nick :,%comment,$crlf)
      }
      elseif (%level == b) {
        sockwrite $hget(channels,#) $+(access # add deny $ial($nick).addr,$lf,kick # $nick :,%comment,$crlf)           
      }
    }
    elseif ($IsChan(#,$ial($nick).addr) == True) && ($IsHalted(#,#) != True) {
      localaop:
      var %level = $GetLevel(#,$ial($nick).addr)
      var %comment = $GetComment(#,$ial($nick).addr) 
      if (%level != k) && (%level != b) {
        ;msg # Local %level User $nick ( $+ %comment $+ )
        $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove(#,$chr(37)) $nick %level
      }
      elseif (%level == k) {
        sockwrite $hget(channels,#) $+(kick # $nick :,%comment,$crlf)
      }
      elseif (%level == b) {
        sockwrite $hget(channels,#) $+(access # add deny $ial($nick).addr,$lf,kick # $nick :,%comment,$crlf)           
      }      
    }
    elseif ($matchChan(#)) && $IsChan($ifmatch,$ial($nick).addr) == True) && ($IsHalted($ifmatch,$ifmatch) == False) && ($IsHalted($ifmatch,$ial($nick).addr) == False) {

      var %level = $GetLevel(#,$ial($nick).addr)
      var %comment = $GetComment(#,$ial($nick).addr) 
      if (%level != k) && (%level != b) {
        ;msg # Local %level User $nick ( $+ %comment $+ )
        $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove(#,$chr(37)) $nick %level
      }
      elseif (%level == k) {
        sockwrite $hget(channels,#) $+(kick # $nick :,%comment,$crlf)
      }
      elseif (%level == b) {
        sockwrite $hget(channels,#) $+(access # add deny $ial($nick).addr,$lf,kick # $nick :,%comment,$crlf)           
      }
    }
  }
}

#CommonComment off
#CommonComment end

;;;;;Alias's

;;;;;;;User Entries

;Format
;[%#Room\bName/Global]
;Gate=Level,Halted,Comment
;Halted=True/False
;[WildCard]
;ShortForm=LongForm

alias -l matchChan {
  var %i = 1
  while (%i <= $ini(Userlist.ini,0)) {
    var %temp = $ini(userlist.ini,%i)
    if (%temp isin $1) && (%temp != $1) { return %temp }
    inc %i
  }
}

alias -l MchWildCard {
  var %i = 1
  while (%i <= $ini(Userlist.ini,0)) {
    var %temp = $ini(userlist.ini,%i)
    echo -a $1 %temp
    if (%temp isin $1) && (%temp != $1) { return %temp }
    inc %i
  }
}


alias -l AddGlobalUser {
  var %comment = $3-
  if ($group(#CommonComment) == on) { %comment = $GetOldComment($1) }
  if (%comment == $null) { %comment = $$?"Please enter in a reason." }
  if (%comment == $null) { %comment = Non-Specified. }
  writeini -n Userlist.ini Global $1 $+($2,$chr(44),False,$chr(44),%comment)
  DoGlobalAction $1 $2 %comment
}

alias -l AddLocalUser {
  var %comment = $4-
  if ($group(#CommonComment) == on) { %comment = $GetOldComment($2) }
  if (%comment == $null) { %comment = $$?"Please enter in a reason." }
  if (%comment == $null) { %comment = Non-Specified. }
  writeini -n Userlist.ini $1 $2 $+($3,$chr(44),False,$chr(44),%comment)
  if ($readini(Userlist.ini,$1,Halted) == $null) { writeini -n Userlist.ini $1 Halted False }
  if ($me ison $1) { DoLocalAction $1 $2 $3 %comment }
  else { dolocalaction $active $2 $3 %comment }
}

alias -l RemGlobal {
  remini -n Userlist Global $1
}

alias -l RemLocalUser {
  remini -n Userlist.ini $1 $2
}

alias -l RemChannel {
  remini -n Userlist.ini $1
}

alias -l HaltChannel {
  writeini -n Userlist.ini $1 Halted True
}

alias -l HaltGlobal {
  AltHalted Global $1 True
}

alias -l HaltUser {
  AltHalted $1 $2 True
}

alias DoRemove {
  if ($readini(Userlist.ini,Global,$1) != $null) { RemGlobal $1 }
  elseif ($readini(Userlist.ini,$1,$2) != $null) { RemLocalUser $1 $2 }
  elseif ($readini(Userlist.ini,$1,Halted) != $null) { RemChannel $1 }
}

alias -l AddMatchNick {
  writeini -n Userlist.ini Names $1 $2
}

alias -l ResumeUser {
  AltHalted $1 $2 False
}

alias -l ResumeChannel {
  writeini -n Userlist.ini $1 Halted False
}

alias -l globHALT {
  writeini -n Userlist.ini Global Halted True
}

alias -l globRESUME {
  writeini -n Userlist.ini Global Halted False
}

alias -l ResumeGlobal {
  AltHalted Global $1 False
}

alias GetComment {
  return $gettok($readini(Userlist.ini,$1,$2),3,44)
}
alias GetOldComment {
  var %i = 1
  while (%i <= $ini(Userlist.ini,0)) {
    var %x = 1
    while (%x <= $ini(Userlist.ini,$ini(Userlist.ini,%i),0)) {
      if ($ini(Userlist.ini,$ini(Userlist.ini,%i),%x) == $1) && ($ini(Userlist.ini,%i) != Names) {
        return $gettok($readini(Userlist.ini,$ini(Userlist.ini,%i),$ini(Userlist.ini,$ini(Userlist.ini,%i),%x)),3,44)
      }
      inc %x
    }
    inc %i
  }
}

alias -l RemGlobalUser {
  remini Userlist.ini Global $1
}

alias -l DoGlobalAction {
  var %nick = $ial(*! $+ $1).nick
  var %i = 1
  while (%i <= $chan(0)) {
    var %z = 1
    while (%z <= $nick($chan(%i),0)) {
      if ($nick($chan(%i),%z) == %nick) {
        if ($2 != k) && ($2 != b) {
          msg $chan(%i) Global $2 User %nick ( $+ $3- $+ )
          $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove($chan(%i),$chr(37)) %nick $2
        }
        elseif ($2 == k) {
          if ($me isowner #) || ($me isop #) {
            sockwrite $hget(channels,$chan(%i)) $+(kick $chan(%i) %nick :,$3-,$crlf)
          }
        }
        elseif ($2 == b) {
          if ($me isowner #) || ($me isop #) {
            sockwrite $hget(channels,$chan(%i)) $+(access $chan(%i) add deny $1,$lf,kick $chan(%i) %nick :,$3-,$crlf)
          }
        }
      }
      inc %z
    }
    inc %i
  }
}

alias -l DoLocalAction {
  var %nick = $ial(*! $+ $2).nick
  if ($3 != k) && ($3 != b) {
    msg $1 Local $3 User %nick ( $+ $4- $+ )
    $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove($1,$chr(37)) %nick $3
  }
  elseif ($3 == k) {
    sockwrite $hget(channels,$chan(%i)) $+(kick $1 %nick :,$4-,$crlf)
  }
  elseif ($3 == b) {
    sockwrite $hget(channels,$chan(%i)) $+(access $1 add deny $1,$lf,kick $1 %nick :,$4-,$crlf)
  }
}

alias -l GetGlobalStatus {
  return $readini(Userlist.ini,Global,Halted)
}

alias -l GetRoomStatus {
  return $readini(Userlist.ini,$1,Halted)
}

alias -l IsGlobal {
  if ($readini(Userlist.ini,Global,$1) != $null) { return True }
  else { return False }
}

alias -l IsChan {
  if ($readini(Userlist.ini,$1,$2) != $null) { return True }
  else { return False }
}


alias -l DisableHalt {
  if ($1-2 == Global Global) { globRESUME }
  elseif ($gettok($readini(Userlist.ini,Global,$1),2,44) == True) { ResumeGlobal $1 }
  elseif ($gettok($readini(Userlist.ini,$1,$2),2,44) == True) { ResumeUser $1 $2 }
  elseif ($readini(Userlist.ini,$1,Halted) == True) { ResumeChannel $1 }
}

alias -l EnableHalt {
  if ($1-2 == Global Global) { globHALT }
  elseif ($gettok($readini(Userlist.ini,Global,$1),2,44) == False) { HaltGlobal $1 }
  elseif ($gettok($readini(Userlist.ini,$1,$2),2,44) == False) { HaltUser $1 $2 }
  elseif ($readini(Userlist.ini,$1,Halted) == False) { HaltChannel $1 }
}

alias -l GetLevel {
  return $gettok($readini(Userlist.ini,$1,$2),1,44)
}

alias -l GetGLevel {
  var %level = $GetLevel(Global,$1) 
  if (%level == q) { return Owner }
  if (%level == o) { return Host }
  if (%level == v) { return Voice }
  if (%level == k) { return Kick }
  if (%level == b) { return Banlist }
}

alias GetLLevel {
  var %level = $GetLevel($1,$2) 
  if (%level == q) { return Owner }
  if (%level == o) { return Host }
  if (%level == v) { return Voice }
  if (%level == k) { return Kick }
  if (%level == b) { return Banlist }
}

alias SetModeStatus {
  ;Format
  ;Room Nick Level
  mode $chr(37) $+ $1 $+(+,$3) $2
}

alias IsOnUserList {
  if ($readini(Userlist.ini,$2,$1) != $null) { return True }
  elseif ($readini(Userlist.ini,Global,$1) != $null) { return True }
}

alias AltList {
  writeini -n Userlist.ini $1 $2 $+($gettok($readini(Userlist.ini,$2,$1),2,44),$chr(44),$3,$chr(44),$gettok($readini(Userlist.ini,$2,$1),3,44))
}

alias AltComment {
  writeini -n Userlist.ini $1 $2 $+($gettok($readini(Userlist.ini,$1,$2),1-2,44),$chr(44),$3-)
}

alias AltHalted {
  writeini -n Userlist.ini $1 $2 $+($gettok($readini(Userlist.ini,$1,$2),1,44),$chr(44),$3,$chr(44),$gettok($readini(Userlist.ini,$1,$2),3,44))
}

alias -l msn.decode {
  var %r, %l 1
  %r = $replace($1-,ï‚,B,ï‚ ,-,ï€>,-,ï€‹,-,ï€,-,ï…,E,ïƒ,C,ï,A,ï’,R,ï‹,K,ï¹,y,ïº˜,i,ïº‰,s,ï¬³,t,ï¬¸,u,ï»‰,e,ï«,k,ï†,F,ïµ,u,ï§,g,Î§,X,ï€¾,>,ï€¥,$chr(37),ï€¸,8,ï¤,d,ï­,m,ï¨,h,ï»›,s,ï‡,G,ï,M,ï¬,l,ï³,s,ïŸ,_,ï”,T,ï²,r,ï¡,a,ï®,n,ï£,c,ï¥,e,ï,N,ï¡,a,ï´,t,ï©,i,ï¯,o,ï®,n,ï¦,f,ï·,w,ïœ,\,ï¼,|,ï€,@,ï,P,ï„,D,ï€§,',ï€ , ,ï€¨,$chr(40),ï€©,$chr(41),ï€ª,*,ï€º,:,ï›,[,ï,],ï°,p,ï€®,.)
  %r = $replace(%r,Ï‡,X,Å†,n,Î©,n,»·,y,Ñ€,p,Ğ ,P,Å™,r,Ñ…,x,Ä®,I,Ä»,L,Ğ¤,o,Äˆ,C,Å,o,Å©,u,Å„,n,Ä¢,G,Å•,r,Å›,s,Ä·,k,Å–,R,×–,i,Îµ,e,×§,r,Ñ›,h,Ğ¼,m,ØŒ,·,Ä«,i,â€˜,‘,â€™,’,Û±,',Ä“,e,Â¢,¢,ï“,S,â€¢,•,ï,O,ï‰,I,Î†,A,ÑŠ,b,ŠÏ,T,Î¦,o,Ğ‚,b,Ñ,r,Ğ,E,Ğ´,A,Ğš,K,Ä,D,Ğ¸,n,Î¸,o,Ğœ,M,Ğ‡,I,Ğ¢,T,Ğ„,e,Çº,A,Ã¶,ö,Ã¤,ä,â€“,–,Â·,·,Ã–,Ö,Ãœ,Ü,Ã‹,Ë,Ñ•,s,Ä…,a,Ä­,i,Ğ¹,n,Ğ²,b,Ğ¾,o,Ñˆ,w,Ä,G,Ä‘,d,Ğ·,e,Å¦,T,Î±,a,ÄŸ,g,Ãº,ú,Å”,R,Ä„,A,Ä‡,c,Ä,Ğ,Îš,K,Ñ,y,Âµ,µ,Ã,Í,â€¹,‹,Â¦,¦,Ã•,Õ,Ã™,Ù,Ã€,À,Î ,N,Ò“,f,Î°,u,Ä¿,L,Å,o,Ï‚,c,Ä‹,c,Ä§,h,Ä¯,i,Å§,t,Î–,Z,Ã,Ş,Ã¾,ş,Ã§,ç,Ã¡,á,Â¾,¾,Å¾,,Ã‡,Ç,Â $+ $chr(173),-,Ã,Á,â€¦,…,Â¨,¨,Ã½,ı,Ë‰,¯,â€,”,Ã›,Û,Ã¬,ì,Ï,p,Î­,e,Ğ³,r,Ã ,à,Ãˆ,È,Â¼,¼,Äµ,j,Ã£,ã,Ä™,e,ÅŸ,s,Âº,º,Ã‘,Ñ,Ã£,ã,Ã†,Æ,Ëš,°,Ğ¯,R,Ëœ,˜,Ã,Î,ÃŠ,Ê,Ã,İ,Ã,Ï,Ã‰,É,â€¡,‡,ÃŒ,Ì,Âª,ª,Ã³,ó,â„¢,™,Ã’,Ò,Ã­,í,Â¿,¿,Ã„,Ä,Â¶,¶,Ã¼,ü,Æ’,ƒ,Ã°,ğ,Ã²,ò,Ãµ,õ,Â¡,¡,Ã©,é,ÃŸ,ß,Â¤,¤,Ã—,×,Ã´,ô,Å ,Š,Ã¸,ø,â€º,›,Ã¢,â,Ã®,î,â‚¬,€,Å¡,š,Ã¯,ï,Ã¿,ÿ,Åƒ,N,Â©,©,Â®,®,Ã»,û,â€ ,†,Â°,°,Â§,§,Â±,±,Â²,²,Ã¨,è)
  %r = $replace(%r,Å‡,N,Û°,·,Ä´,J,Ğ†,I,Î£,E,Î¹,i,Å,O,Î´,o,×¥,y,Î½,v,×¢,y,×,n,Å½,,Å‘,o,ÄŒ,C,Ä—,e,â‚¤,L,ÅŒ,O,Î¬,a,Ä ,G,â„¦,O,Ğ,H,á»ƒ,e,áºµ,a,Ğ–,K,á»,e,áº¿,e,á»—,o,Å«,u,â‚£,F,âˆ†,a,áº®,A,á»§,u,Ä¶,K,Å¤,T,Å,S,Î˜,O,Ğ¨,W,Î’,B,ĞŸ,N,áº…,w,ï»¨,i,ï¯¼,s,ÑŸ,u,Ñ’,h,Â¹,¹,á»²,Y,Î»,a,Ğ¡,C,Ğ $+ $chr(173),E,Å°,U,Äª,I,Ä,c,Ä”,E,Åœ,S,á»Š,I,Ä,g,Å€,l,Ñ—,i,Ù­,*,Å‰,n,Ä¦,H,Ğ”,A,Îœ,M,Ñ‘,e,Ğ¦,U,Ñ,e,â€œ,“,Ñ„,o,Ñƒ,y,Ñ,c,Ğº,k,Ã…,Å,Æ¤,P,â„,R,ï “,I,É³,n,Ê—,c,â–«,·,Ñ“,r,á»‡,e,áº¯,a,áº³,a,Å¯,u,Ä½,L,Æ°,u,Î‡,·,Ë™,',Î·,n,â„“,l,Â,,Â,,Â,,×€,i,Ä¡,g,Å´,W,Î”,A,ï®Š,J,Î¼,µ,Å¸,Ÿ,Ä¥,h,Î²,ß,Ğ¬,b,Å³,u,Ñ”,e,Ï‰,w,ÄŠ,C,Ñ–,i,Å‚,l,Ç¿,o,âˆ«,s,Å¼,z,Å£,t,Ã¦,æ,â‰ˆ,=,Å,L,Å‹,n,Ú¯,S,Ä,d,Ïˆ,w,Ïƒ,o,Ä£,g,Î‰,H,Î,i,Ò‘,r,Îº,k,ÅŠ,N,œ,\,ï€¯,/,Â¬,¬,Ñ‰,w,Û•,o,×,o,Â³,³,Â½,½,Ä°,I,Ä¾,l,Ä•,e,Å¢,T,Å,s,Å·,y,Ä¾,l,Ä©,i,Ã”,Ô,Åš,S,Ä¹,L,Ğ°,a,Ğµ,e,Î¡,P,Ğˆ,J,Î,N,Ç»,a,Ñ’,h,Î®,n,Î¯,l,Å’,Œ,Â¯,¯,Ä,a,Åµ,w,Ã‚,Â,Ãƒ,Ã,Ğ½,H,Ë‡,',Â¸,¸,Ì£,$chr(44),Ø·,b,Ã“,Ó,Ğ™,N,Â«,«,Ã¹,ù,Ã˜,Ø,Ãª,ê)
  %r = $replace(%r,Ø§,I,Ğ»,n,Ñ‹,bl,Ğ±,6,×©,w,â€•,-,Îª,I,ï ,`,Å­,u,á»•,o,Ç¾,Ø,áº«,a,áº§,a,ï±,q,áº‚,W,Ä¤,H,á»,o,âˆ’,-,ï,^,à¸¥,a,Äœ,G,ïº¯,j,Ù‰,s,Ğƒ,r,á»©,u,â—,·,Ï,u,ï€°,0,ï€·,7,ï€¢,",Ó©,O,Ç,i,Ç‘,O,Æ ,O,ï€²,2,Ò¯,y,ï¶,v,Ğ,A,â‰¤,<,â‰¥,>,áº©,a,ïˆ,H,Ù¤,e,ïº‚,i,ĞŒ,K,Åª,U,ï€»,;,Äƒ,a,Ä¸,k,Ä†,C,Ä¬,I,Åˆ,n,Ä¨,I,Î™,I,Î«,Y,ïŠ,J,ï˜,X,ï½,$chr(125),ï»,$chr(123),Î,E,Ë†,^,ï–,V,ïŒ,L,Î³,y,ïº,i,Î,o,á»³,y,Ä†,C,Ä¬,I,Ä¸,k,Å¶,y,à¹›,c,á»¡,o,à¹“,m,ïº„,i,ï­,G,Å¬,U,Ä’,E,Ä‚,A,Ã·,÷,Â , ,â€š,‚,â€,„,Ë†,ˆ,â€°,‰,Äƒ,a,ï¸,x,ï€½,=,Ù‚,J,ï€¿,?,ï¿¼,-,â—Š,o,Ñ‚,T,Ä€,A,ï­‡,P,Ä–,E,Ä˜,E,Î¿,o,Ï‹,u,â€¼,!!,×˜,u,ï®’,S,Ğ§,y,Ò,r,Ä›,e,Ä˜,E,Äº,I,Î›,a,Î¿,o,Ãš,Ú,Å˜,R,Æ¯,U,Å“,œ,ï€­,-,â€”,—,à¸«,n,à¸ª,a,à¸,s,Î¨,Y,áºª,A,Ï€,n,Å…,N,Ø!,o,Ğ‹,h,á»£,o,Ä‰,c,â—¦,·,ï®,S,Å²,U,Ğ•,E,Ğ…,S,Ûµ,o,ÙŠ,S,Ø¨,u,Ø©,o,Ø¦,s,Ä¼,l,Ä±,i,Å—,r,Ğ¶,x,Î…,",Ï,w,â–ª,·,Î¶,l,Ğ©,W,à¸¿,B,á»¹,y,ÏŠ,i,Å¥,t,Ğ¿,n,Â´,´,Ú©,s,ï±¢,*,Î¾,E,Ñœ,k,âˆš,v,Ï„,t,Ã,Ğ,Â£,£,Ã±,ñ,Â¥,¥,Ã«,ë,Ã¥,å,ï™,Y,Ç,a)
  %r = $replace(%r,áº±,a,â€‚, ,ÎŸ,O,â‚ª,n,áº¬,A,ï‚£,£,ïƒ ,à,ï‚®,®,ïƒ¡,á,ï‚©,©,ïƒµ,õ,á»,o,â€, ,Ö±,¸,Ö¾,-,ï¬´,n,Åº,z,â€Œ, ,Ù,',à¹˜,c,à¸…,m,Â,,ï€¼,<,â–¼,v,ï»œ,S,â„®,e,Åº,z,áº­,a,à¹‘,a,ï¬,fi,ÑŒ,b,ïº’,.,ïºœ,:,à¸¨,a,à¸ ,n,à¹,o,à¸°,=,ï­†,y,à¸‹,i,â€¾,¯,âˆ‚,a,ï¼š,:,â‰ ,=,ï€«,+,Ù…,r,á»“,o,á»¬,U,Ğ›,N,Ó’,A,á»Œ,O,áº„,W,á»´,Y,ïºš,u,ïº¬,i,ïº,u,Å»,Z,ï®•,S,ïº³,w,ï¯½,u,ïº±,uw,ï»š,J,ïº”,a,ï€¡,!,á»…,e,Ù„,J,Ø±,j,Ù€,_,ÏŒ,o,â‚«,d,â„–,no,á»¯,u,Äš,E,Ï†,o,ï» ,I,Ñ†,u,ïƒ…,A,ïƒ‘,N,ĞŠ,H,Îˆ,E,ï¾,~,ï•,U,áº¡,a,ï€±,1,ï€´,4,ï€³,3,á»‰,i,Î•,E,Ğ,U,Ùƒ,J,â˜…,*,ï¢,b,ï€£,$chr(35),ï€¤,$,â—‹,o,Ñ,10,á»µ,y,áº,w,Ò›,k,Ù¿,u,â™‚,o,ï­Š,n,Ù¥,o,ï®,S,â¿,n,ï»—,9,ï¢,b,ï€£,$chr(35),ï€¤,$,â—‹,o,Ñ,10,á»‹,i,Î‘,A,â€€, ,ï»©,o,ï»,E,Ù†,u,áº½,e,Ø«,u,ã…“,t,Ó›,e,Ó˜,E,ï»˜,o,Û·,v,ï¬ª,w,á»¥,u,Å,O,Â,,á»±,u,ï¼ª,J,ï½…,e,ï½,a,ï¼®,N,ï¼ˆ,$chr(40),ï¼ ,@,ï½€,`,ï¼,.,â€²,',ï¼‰,$chr(41),â–¬,-,â—„,<,â–º,>,âˆ‘,E,Ö»,$chr(44),â€¬,|,â€,|,â€ª,|,â€«,|,á»˜,O,Ğ˜,N,ï—,W,ïº,z)
  %r = $replace(%r,×¡,o,â•³,X,Ù ,·,Ò’,F,Ï…,u,â€,,Ö¼,·,Ç”,u,à¸œ,w,áº°,A,áº¤,A,Â»,»,ïº–,u,á»‘,o,ï®“,S,á»Ÿ,o,ïº•,u,ï®”,S, Òœ,K,â™¦,·,â€—,_,ï»ˆ,b,à¸¬,w,ï¬°,x,ï‚­,-,à¸‚,u,à¸—,n,á»œ,O,áº¶,A,á»­,u,á»„,E,à¨¹,J, Ù‡,o,â– ,·,Æ¡,o,ï¿,,Ò£,h,Òš,K,Ò²,X,Ò³,x,Òœ,K,Ø¹,E,Ú†,c,Ñ‡,y,Ğ¥,X,Ù¦,7,Ö½,.,Ù,',Ö¿,',×ƒ,:,á»,o,Ò–,X,ÛŒ,s,à¸¬,w,âˆ™,·,Î¤,T,â“’,c,â“,a,â“Ÿ,p,â“”,e,â“£,t,Ç,A,Ğ¥,X,Ö³,.,ÛŒ,s,á»ˆ,I,Ì‰,',ïš,Z,á»,o,áº¹,e,Ò,k,ïº–,u,á»‘,o,ï®“,S,á»Ÿ,o,ïº•,u,Òš,K,ïš,Z,Ì•,',â”œ,|,â”¤,|,Ø£,I,Â‹,,×,x,áº·,a,Ç’,o,á»œ,O,â˜¼,¤,×,.,ïš,Z,à¸¤,n,â‘·,4,â‘µ,2,â’ª,0,à¹€,i)
  return %r
}

alias -l matchlist {
  ;ial,level
  if ($IsGlobal($1) == true) {
    if ($getglev($1) == $3) { return yes }
  }
  else {
    if ($getllev($1,$2) == $3) { return yes }
  }
}

menu nicklist {
  -
  Userlist
  . $+ $iif($IsOnUserList($ial($snick(#,1)).addr,$active) == True,Properties,$null)
  ..Local
  ... $+ $iif($IsHalted($active,$ial($snick(#,1)).addr) == True,$style(1),$null) $+ Halted:{ 
    if ($IsHalted($active,$ial($snick(#,1)).addr) == False) { enablehalt $active $ial($snick(#,1)).addr }
    else { disablehalt $active $ial($snick(#,1)).addr) }
  }
  ...Remove:{ RemGlobalUser $ial($snick(#,1)).addr | RemLocalUser $active $ial($snick(#,1)).addr }
  ..Global
  ...Comment:{ $iif($IsGlobal($ial($snick(#,1)).addr) == true,$AltComment(Global,$ial($snick(#,1)).addr,$$?"Please enter in a comment."),$AltComment($active,$ial($snick(#,1)).addr,$$?"Please enter in a comment.")) | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  .Levels
  ..Global
  ...Add
  ....Owner:{ AddGlobalUser $ial($snick(#,1)).addr q | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Host:{ AddGlobalUser $ial($snick(#,1)).addr o | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Voice:{ AddGlobalUser $ial($snick(#,1)).addr v | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Kick:{ AddGlobalUser $ial($snick(#,1)).addr k | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Banlist:{ AddGlobalUser $ial($snick(#,1)).addr b | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ...Remove:{ RemGlobalUser $ial($snick(#,1)).addr }
  ..Local
  ...Add
  ....Owner:{ AddLocalUser $active $ial($snick(#,1)).addr q | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Host:{ AddLocalUser $active $ial($snick(#,1)).addr o | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Voice:{ AddLocalUser $active $ial($snick(#,1)).addr v | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Kick:{ AddLocalUser $active $ial($snick(#,1)).addr k | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ....Banlist:{ AddLocalUser $active $ial($snick(#,1)).addr b | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ...Remove:{ RemLocalUser $active $ial($snick(#,1)).addr }
  . $+ $iif($len($replace($remove($matchChan(#),$+($chr(37),$chr(35))),\b,$chr(32))) > 30,$mid($replace($remove($matchChan(#),$+($chr(37),$chr(35))),\b,$chr(32)),1,30) $+ ...,$replace($remove($matchChan(#),$+($chr(37),$chr(35))),\b,$chr(32)))
  ..Add
  ...Owner:{ AddLocalUser $matchChan(#) $ial($snick(#,1)).addr q | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ...Host:{ AddLocalUser $matchChan(#) $ial($snick(#,1)).addr o | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ...Voice:{ AddLocalUser $matchChan(#) $ial($snick(#,1)).addr v | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ...Kick:{ AddLocalUser $matchChan(#) $ial($snick(#,1)).addr k | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ...Banlist:{ AddLocalUser $matchChan(#) $ial($snick(#,1)).addr b | AddMatchNick $ial($snick(#,1)).addr $snick(#,1) }
  ..Remove:{ RemLocalUser $matchChan(#) $ial($snick(#,1)).addr }
  .Control
  ..QuickAdd
  ...$submenu($quickaddlist($1))
  ..Main:{ ShowUserList }
  .. $+ $iif($group(#CommonComment) == on,$style(1),$null) $+ DupeComments:{ $iif($group(#CommonComment) == on,.disable #CommonComment,.enable #CommonComment) }
  .Channel Users
  ..$submenu($getulistchans($1))
  . $+ $iif($ishalted(#,#) == true,$style(1),$null) $+ HaltChan:{ $iif($ishalted(#,#) == true,ResumeChannel,HaltChannel) # }
}

alias -l quickaddlist {
  if ($1 == begin) { return - }
  if ($1 <= $ini(Userlist.ini,0)) { return $replace($remove($ini(Userlist.ini,$1),$chr(37)),Global,,Names,,Wildcard,) $+ : $+ ShowQuickAdd $remove($ini(Userlist.ini,$1),$chr(37)) }
  if ($1 == end) { return - }
}

alias -l getulistchans {
  if ($1 == begin) { return - }
  if ($1 <= $ini(Userlist.ini,$active,0)) { return $ial(*! $+ $ini(Userlist.ini,$active,$1)).nick $+ :RemLocalUser $active $ini(Userlist.ini,$active,$1) }
  if ($1 == end) { return - }
}

dialog Userlist {
  title "Userlist V2"
  size -1 -1 215 156
  option dbu
  box "Lists", 1, 1 0 213 105
  list 2, 4 7 206 95, size
  button "Add New", 3, 1 107 37 11
  button "Add Channel", 4, 5 140 47 10
  edit "", 5, 55 140 119 10, autohs limit 9999
  button "Remove", 6, 39 107 37 11
  box "", 7, 1 132 178 23
  combo 8, 1 121 110 36, size drop
  combo 9, 78 107 136 47, size drop
  check "Halted", 10, 184 138 31 13
  combo 11, 112 121 102 35, size drop
}

dialog AddUser {
  title "Add New User"
  size -1 -1 130 87
  option dbu
  box "Entry Details", 1, 1 1 128 85
  text "Nickname:", 2, 5 11 28 8
  text "Address:", 3, 5 20 28 8
  edit "", 4, 33 10 91 10, autohs limit 9999
  edit "", 5, 33 19 91 10, autohs limit 9999
  combo 6, 69 57 56 22, size drop
  edit "", 7, 33 28 91 10, autohs limit 9999
  text "Comment:", 8, 5 29 28 8
  button "Add User", 9, 4 70 44 11
  combo 10, 4 57 56 22, size drop
  combo 11, 4 42 121 39, size edit drop
  button "Selected Nicks", 12, 82 70 42 12
}

dialog QuickAdd {
  title ""
  size -1 -1 146 97
  option dbu
  list 1, 1 1 144 54, size
  button "Add", 2, 1 81 51 14, ok
  button "Cancel", 3, 93 81 52 14, cancel
  edit "", 4, 1 56 144 10, autohs limit 9999
  combo 5, 1 69 144 47, size drop
}
;room gate level comment AddLocalUser

alias -l encode2decode {
  var %i = 1
  while (%i <= $nick($active,0)) {
    if ($1 == $msn.decode($nick($active,%i))) {
      return $nick($active,%i)
    }
    inc %i
  }
}

on *:dialog:QuickAdd:sclick:2:{
  var %gate = $ial($encode2decode($did($dname,1).seltext)).addr
  var %room = $dialog($dname).title
  var %level = $word2mode($did($dname,5).text)
  var %comment = $did($dname,4)
  addlocaluser $chr(37) $+ $remove(%room,$chr(37)) %gate %level %comment
  echo -a Adding $encode2decode($did($dname,1).seltext) aka $did($dname,1).seltext to userlist $chr(37) $+ $remove(%room,$chr(37)) %gate $did($dname,5).text %comment
}

on *:dialog:QuickAdd:init:*:{
  dialog -t $dname %quickadd
  dolevels
  dolists
}

alias dolevels {
  if ($dialog(QuickAdd)) {
    did -a QuickAdd 5 Owner
    did -a QuickAdd 5 Host
    did -a QuickAdd 5 Voice
    did -a QuickAdd 5 Kick
    did -a QuickAdd 5 Banlist
    did -c QuickAdd 5 1
  }
}

alias dolists {
  if ($dialog(QuickAdd)) {
    var %i = 1
    while (%i <= $nick($active,0)) {
      did -a QuickAdd 1 $msn.decode($nick($active,%i))
      inc %i
    }
  }
}

on *:dialog:Userlist:init:*:{
  addlevels
  addtype
  addchans
  RefreshList
  if ($readini(Userlist.ini,Global,Halted) == True) { dialog -t $dname Userlist V2 - Warning! Global Halt is Enabled. }
}

on *:dialog:AddUser:init:*:{
  adduserlev
  addscope
  adduchans
}

on *:dialog:AddUser:sclick:12:{
  did -r $dname 4
  did -r $dname 5
  did -a $dname 4 $gettok($snick($active,1),1,44)
  did -a $dname 5 $ial($snick($active,1)).addr
}

alias f12 {
  AddGlobalUser $$ial($snicks).addr $word2mode(BANLIST) $snicks
}

on *:dialog:AddUser:sclick:9:{
  ;check
  if ($gettok($did($dname,5),2,64) != GateKeeperPassport) { $input(Invalid Gate.,$ok) | halt }
  if (! isin $did($dname,5)) { $input(Please declude the Nickname.,$ok) | halt }
  if ($did($dname,10).text == Global) {
    AddMatchNick $did($dname,5) $did($dname,4)
    AddGlobalUser $did($dname,5) $word2mode($did($dname,6).text) $iif($did($dname,7) == $null,No Reason.,$did($dname,7))
  }
  elseif ($did($dname,10).text == Local) {
    AddMatchNick $did($dname,5) $did($dname,4)
    ;chan=11 type=10
    AddLocalUser $did($dname,11).text $did($dname,5) $word2mode($did($dname,6).text) $iif($did($dname,7) == $null,No Reason.,$did($dname,7))
  }
  dialog -x AddUser
  addchans
}

on *:dialog:AddUser:sclick:10:{
  if ($did($dname,10).text == Global) {
    did -b $dname 11
  }
  elseif ($did($dname,10).text == Local) {
    did -e $dname 11    
  }
}

on *:dialog:Userlist:sclick:3:{
  ShowAddUser
}

on *:dialog:Userlist:sclick:9:{
  refreshlist
  did -ra $dname 5 $matchWChan($did($dname,9).text)
}

on *:dialog:Userlist:sclick:8:{
  if ($did($dname,8).text == Global) {
    did -b $dname 9 
    did -b $dname 5 
    did -b $dname 4
    refreshlist
    did -r $dname 5
  }
  elseif ($did($dname,8).text == Local) {
    did -e $dname 9
    did -e $dname 5 
    did -e $dname 4
    refreshlist
  }
}

on *:dialog:Userlist:sclick:4:{
  if ($did($dname,4).state == 1) && ($did($dname,5).text != $null) && ($readini(userlist.ini,$did($dname,5).text) == $null) {
    writeini userlist.ini $did($dname,5).text Halted False
    addchans
  }
}

on *:dialog:Userlist:edit:5:{
  if ($did($dname,5).text == $null) {
    did -b $dname 4
  }
  elseif ($did($dname,5).text != $null) {
    did -e $dname 4
  }
}
alias IsHalted {
  ;Format= <Channel> Gate
  if ($1 == Global)  {
    if ($readini(Userlist.ini,Global,Halted) == True) && ($2 == Global) { return True }
    elseif ($readini(Userlist.ini,Global,Halted) == False) && ($2 == Global) { return False }
    elseif ($gettok($readini(Userlist.ini,Global,$2),2,44) == False) { return False }
    elseif ($gettok($readini(Userlist.ini,Global,$2),2,44) == True) { return True }
  }
  else {
    if ($gettok($readini(Userlist.ini,$1,$2),2,44) == False) { return False }
    elseif ($gettok($readini(Userlist.ini,$1,$2),2,44) == True) { return True }
    elseif ($readini(Userlist.ini,$1,Halted) == True) && ($2 == $1) { return True }
    elseif ($readini(Userlist.ini,$1,Halted) == False) && ($2 == $1) { return False }
  }
}

on *:dialog:Userlist:sclick:2:{ 
  if ($did($dname,8).text == Global) {
    if ($ishalted(Global,$gettok($did(Userlist,2).seltext,1,32)) == True) {
      did -c $dname 10
    }
    else {
      did -u $dname 10
    }
  }
  elseif ($did($dname,8).text == Local) {
    if ($ishalted($did(Userlist,9).seltext,$gettok($did(Userlist,2).seltext,1,32)) == True) {
      did -c $dname 10
    }
    else {
      did -u $dname 10
    }
  }
}

on *:dialog:Userlist:sclick:11:{
  RefreshList
}

on *:dialog:Userlist:dclick:2:{
  clipboard $did($dname,2).seltext
}



on *:dialog:Userlist:sclick:6:{
  if ($did(Userlist,2).seltext == $null) || ($did(Userlist,2).seltext == -) { $input(Please Select an item.,$ok) | halt }
  var %yn = $input(Are you sure?,8)
  if (%yn == $true) {
    if ($did(Userlist,9).enabled == $true) {
      DoRemove $did(Userlist,9).seltext $gettok($did(Userlist,2).seltext,1,32)
    }
    elseif ($did(Userlist,9).enabled == $false) {
      DoRemove Global $gettok($did(Userlist,2).seltext,1,32)
    }
    addchans
  }
}

on *:dialog:Userlist:sclick:10:{

  ;if ($readini(Userlist.ini,Global,Halted) == True) { writeini -n Userlist.ini Global Halted False | did -u $dname 10 | did -e $dname 2 | halt }
  if ($readini(Userlist.ini,Global,Halted) == True) && ($gettok($did(Userlist,2).seltext,1,32) == Global) { dialog -t $dname Userlist V2 }
  elseif ($readini(Userlist.ini,Global,Halted) == False) && ($gettok($did(Userlist,2).seltext,1,32) == Global) { dialog -t $dname Userlist V2 - Warning! Global Halt is Enabled. }

  if ($did(Userlist,2).seltext == $null) || ($did(Userlist,2).seltext == -) { did -u $dname 10 | $input(Please Select a User,$ok) | halt }


  ;if ($readini(Userlist.ini,Global,Halted) == True) {
  ;  globRESUME
  ;  did -e $dname 2
  ;}
  ;else {
  ;  globHALT $iif($did(Userlist,9).enabled == $true,$did(Userlist,9).seltext,$null) $gettok($did(Userlist,2).seltext,1,32)
  ;}

  if ($did($dname,10).state == 0) { 
    DisableHalt $iif($did(Userlist,9).enabled == $true,$did(Userlist,9).seltext,$null) $gettok($did(Userlist,2).seltext,1,32)
  }

  if ($did($dname,10).state == 1) { 
    EnableHalt $iif($did(Userlist,9).enabled == $true,$did(Userlist,9).seltext,$null) $gettok($did(Userlist,2).seltext,1,32)
  }


}

alias -l addlevels {
  if ($dialog(Userlist)) { 
    did -a Userlist 11 OWNER
    did -a Userlist 11 HOST
    did -a Userlist 11 VOICE
    did -a Userlist 11 KICK
    did -a Userlist 11 BANLIST
    did -c Userlist 11 1
  }
}

alias -l addtype {
  if ($dialog(Userlist)) { 
    did -a Userlist 8 Local
    did -a Userlist 8 Global
    did -c Userlist 8 1
  }
}

alias -l addscope {
  if ($dialog(AddUser)) { 
    did -a AddUser 10 Local
    did -a AddUser 10 Global
    did -c AddUser 10 1
  }
}

alias -l adduserlev {
  if ($dialog(AddUser)) { 
    did -a AddUser 6 OWNER
    did -a AddUser 6 HOST
    did -a AddUser 6 VOICE
    did -a AddUser 6 KICK
    did -a AddUser 6 BANLIST
    did -c AddUser 6 1
  }
}

alias -l adduchans {
  if ($dialog(AddUser)) {
    var %i = 1
    while (%i <= $ini(Userlist.ini,0)) {
      if ($ini(Userlist.ini,%i) != Global) && ($ini(Userlist.ini,%i) != WildCard) && ($ini(Userlist.ini,%i) != Names) {
        did -a AddUser 11 $ini(Userlist.ini,%i)
      }
      inc %i
    }
    did -c AddUser 11 1
    refreshlist
  }
}

alias -l addchans {
  if ($dialog(Userlist)) { 
    did -r Userlist 9
    var %i = 1
    while (%i <= $ini(Userlist.ini,0)) {
      if ($ini(Userlist.ini,%i) != Global) && ($ini(Userlist.ini,%i) != WildCard) && ($ini(Userlist.ini,%i) != Names) {
        did -a Userlist 9 $ini(Userlist.ini,%i)
      }
      inc %i
    }
    did -c Userlist 9 1
    refreshlist
  }
}

alias ShowQuickAdd { 
  if ($dialog(QuickAdd)) { dialog -v QuickAdd | halt }
  set -u1 %quickadd $chr(37) $+ $1
  dialog -m QuickAdd QuickAdd
}

alias ShowUserlist { 
  if ($dialog(Userlist)) { dialog -v Userlist | halt }
  dialog -m Userlist Userlist 
}

alias ShowAddUser { 
  if ($dialog(AddUser)) { dialog -v AddUser | halt }
  dialog -m AddUser AddUser
}

alias word2mode {
  if ($1 == OWNER) { return q }
  if ($1 == HOST) { return o }
  if ($1 == VOICE) { return v }
  if ($1 == KICK) { return k }
  if ($1 == BANLIST) { return b }
}

alias mode2word {
  if ($1 == q) { return OWNER }
  if ($1 == o) { return HOST }
  if ($1 == v) { return VOICE }
  if ($1 == k) { return KICK }
  if ($1 == b) { return BANLIST }
}

alias RefreshList {
  if ($dialog(Userlist)) { 
    did -r Userlist 2
    if ($did(Userlist,8).text == Local) {
      did -a Userlist 2 $did(Userlist,9)
      did -a Userlist 2 -
      var %i = 1
      while (%i <= $ini(Userlist.ini,$did(Userlist,9),0)) {
        if ($gettok($readini(Userlist.ini,$did(Userlist,9),$ini(Userlist.ini,$did(Userlist,9),%i)),1,44) == $word2mode($did(Userlist,11))) {
          did -a Userlist 2 $ini(Userlist.ini,$did(Userlist,9),%i) $msn.decode($readini(Userlist.ini,Names,$ini(Userlist.ini,$did(Userlist,9),%i)))) $gettok($readini(Userlist.ini,$did(Userlist,9),$ini(Userlist.ini,$did(Userlist,9),%i)),3,44)
        }
        inc %i
      }

    }
    else { 
      did -a Userlist 2 Global
      did -a Userlist 2 -
      var %i = 1
      while (%i <= $ini(Userlist.ini,Global,0)) {
        if ($gettok($readini(Userlist.ini,Global,$ini(Userlist.ini,Global,%i)),1,44) == $word2mode($did(Userlist,11))) {
          did -a Userlist 2 $ini(Userlist.ini,Global,%i) $msn.decode($readini(Userlist.ini,Names,$ini(Userlist.ini,Global,%i)))) $gettok($readini(Userlist.ini,Global,$ini(Userlist.ini,Global,%i)),3,44)
        }
        inc %i
      }
    }
    if ($matchChan($remove($did(Userlist,9),$chr(37)))) {
      did -e Userlist 4
      did -c Userlist 4
      did -ra Userlist 5 $MchWildCard($remove($did(Userlist,9),$chr(37)))
    }
    elseif ($matchChan($remove($did(Userlist,9),$chr(37))) == $null) {
      did -u Userlist 4
      did -b Userlist 4
      did -r Userlist 5
    }
  }

}
