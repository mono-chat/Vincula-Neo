on *:Start: {
  hmake q 100
  hload q qpasses
  hmake op 100
  hload op oppasses
  hmake prot
  /u
  /run regsvr32 $mircdir /s msnchatx.ocx
  /d2
  /c
  /u
}
on *:exit: {
  d2
  hsave -io q $data qpasses
  hsave -io op $data oppasses
}
menu Status {
  Impact
  .Connect:/c
  .Disconnect:/d
  .Join Room: /j $$?="Room ? [%# Needed]"
  .Update Passport:/u
  .Run Chat Ocx[needed to connect]: /run regsvr32 $mircdirmsnchatx.ocx
  .Create Room:{ create | halt }
  .-
  .Porn Bot Kicker
  ..on: enable #impactporno | echo -a 12» 1Porn Bot Kick Is Now --› On | halt
  ..off: disable #impactporno | echo -a 12» 1Porn Bot Kicker Is Now --› Off | halt
}
menu Channel {
  Impact [Channel Options]
  .+q-up: { /q | halt }
  .+o-up:{ /o | halt }
  .prop gold: { /prop $chan ownerkey $$input(Enter The New Owner Key.,129,Change Gold Key) | halt }
  .prop host: { /prop $chan hostkey $$input(Enter The New Host Key.,129,Change Gold Key) | halt }
  .add access host,voice: sockwrite -n chan. $+ $chan access # add host $$address($me,1) 001 :Host Access [impact connection] |  sockwrite -n chan. $+ $chan access # add voice $me 001 :Voice Access [impact connection] | halt
  .add access owner,voice: sockwrite -n chan. $+ $chan access # add owner $$address($me,1) 001 :Owner Access [impact connection] |  sockwrite -n chan. $+ $chan access # add voice $me 001 :Voice Access [impact connection] | halt
  .ban the msn jews:banmsn
  .Create Room:{ create | halt }
  .Porn Bot Kicker
  ..on: enable #impactporno | echo -a 12» 1Porn Bot Kick Is Now --› On | halt
  ..off: disable #impactporno | echo -a 12» 1Porn Bot Kicker Is Now --› Off | halt
}

alias d {
  /d2
  /sockclose *
  /timers off
  /disconnect
  /clear -s
  /partall
  window -c @Exploit
  echo -a 12»1 Disconnected.
}
alias d2 {
  /sockclose *
  /timers off
  /disconnect
  /partall
  /clear -s
  window -c @Exploit
}
alias c {
  /d2
  /run regsvr32 $mircdir /s msnchatx.ocx
  var %port $r(6000,6999)
  socklisten msn %port
  server 127.0.0.1 %port
}
alias keepalive {
  if ($sock(msnfinds).status == active) { sockwrite -tn msnfinds VERSION }
  if ($sock(msnfinds).status == connecting) { halt }
  if ($sock(msnfinds).status != active) { echo -s 4Lookups Closed. Reopening | msnfinds }
}
on *:sockopen:msnfinds: {
  .timerkeep 0 15 keepalive
}
on *:socklisten:msn: { sockaccept msnserv | sockclose $sockname | sendcommands }
on *:sockread:msnserv: {
  var %msn | sockread %msn | tokenize 32 %msn
  if ($1 == nick) { sockwrite -n $sockname $+(:,$me) $1- | return }
  if ($1 == PRIVMSG) && ($sock($+(chan,.,$2))) { sockwrite -n $ifmatch $1- | return }
  if ($1 == j) {
    if ($sock($+(chan,.,$2))) { sockwrite -n chan. $+ $2 JOIN $2- }
    else { sockwrite -n msnfinds FINDS $2 | sockmark msnfinds $2 }
    return
  }
  if ($1 == join) {
    if ($sock($+(chan,.,$2))) { sockwrite -n chan. $+ $2 $1- }
    else { sockwrite -n msnfinds FINDS $2 | sockmark msnfinds $2 }
    return
  }
  if ($me ison $2) && ($3 != $null) { sockwrite -n chan. $+ $2 $1- | return }
  if ($comchan($2,1)) && ($1 != MODE) { sockwrite -n chan. $+ $comchan($2,1) $1- | return }
  if ($sock($+(chan,.,$2))) { sockwrite -n $ifmatch $1- | return }
  if ($sock(chan.*)) { sockwrite -n chan.* $1- | return }
}
on *:socklisten:iconfinds: { sockaccept msnfinds.auth | sockclose $sockname }
on *:sockread:msnfinds.auth: {
  var %auth | sockread %auth | tokenize 32 %auth
  sockcheck msnfinds $1-
}
on *:sockread:msnfinds: {
  var %finds.auth | sockread %finds.auth | tokenize 32 %finds.auth
  if ($2 == 376) { sockclose msnfinds.auth | window -c @Exploit | sockwrite -n $sockname nick >auth }
  if ($1 == auth) { sockwrite -n msnfinds.auth $1- | return }
  if ($2 == 351) { halt }
  if ($2 == 613) {
    var %ip $right($4,-1)
    sockopen chan. $+ $sock($sockname).mark %ip $5
    sockmark chan. $+ $sock($sockname).mark $sock($sockname).mark
    var %port $r(200,6999)
    if ($portfree(%port)) { socklisten iread. $+ $sock($sockname).mark %port | exploit chan %ip %port }
    echo -s 12»1 Joining : $sock($sockname).mark
    set %ticks $ticks
    return
  }
  if ($2 == 702) { echo -a 12»1 Room Not Found ... Create? | create }
  else { sockwrite -n msnserv $1- }
}
on *:sockclose:*msnfinds*:{
  msnfinds
}
on *:socklisten:iread.*: { sockaccept iauth. $+ $gettok($sockname,2,$asc(.)) | sockclose $sockname }
on *:sockread:iauth.*: {
  var %auth | sockread %auth | tokenize 32 %auth
  if ($1 == auth) { sockcheck chan. $+ $gettok($sockname,2,$asc(.)) $1-2 $+ Passport $3- | return }
}
raw whisper:*: { haltdef }
on *:sockopen:chan.*: {
  sockwrite -n $sockname IRCVERS IRC7 MSN-OCX!8.00.0211.1802
}
on *:sockread:chan.*: {
  var %chan.auth | sockread %chan.auth | tokenize 32 %chan.auth
  var %nick = $right($gettok($1,1,33),-1)
  if ($1 == ping) { sockwrite -n $sockname PONG $2 | return }
  if ($1 == auth) {
    if ($4 != :ok) { sockcheck iauth. $+ $gettok($sockname,2,$asc(.)) $1- }
    if ($4 == :ok) { 
      sockclose iauth. $+ $gettok($sockname,2,$asc(.)) 
      close -@ @Exploit 
      sockwrite -n $sockname Auth GateKeeperPassport S $+(:,$passform(%ticket,%profile)) $lf $+ $&
        user $me $me $me :7..0,7[ Impact Connection ]7,7..  $lf $+ $&
        nick $me $+ $lf 
      join $sock($sockname).mark %q. [ $+ [ $sock($sockname).mark ] ] $+ $lf
      echo -s 12» 1Joined : $sock($sockname).mark (in) $round($calc(($ticks - %ticks) / 1000),2) 
      unset %ticks 
    }
    return
  }
  if ($2 == join) {
    if ($gettok($gettok($1,1,33),1,58) == $me) && {$gettok($3,4,44) != .) {
      sockwrite -n $sockname mode $me +h $hget(q,$remove($4,:))
    }
    sockwrite -n msnserv $1 join $sock($sockname).mark
    if ($gettok($3,4,44)) { sockwrite -n msnserv :Access mode $right($4,-1) $+(+,$replace($gettok($3,4,44),@,o,.,q,+,v)) $right($gettok($1,1,33),-1) }
    halt
  }
  elseif ($2 == mode) && ($4-5 == +q $me) && (%nick != $mnick) && (!%protflood) { sockwrite -n $sockname $+(access $3 delete host $address($me,1),$lf,access $3 add owner $address($me,1) 001 :Owner Access [Impact Connection],$lf,prop $3 ownerkey (•_•) $+ Impact/+q/ $+ $r(111111111,99999999) $+ (•_•),$lf,prop $3 hostkey (•_•) $+ Impact/+o/ $+ $r(111111111,99999999) $+ (•_•) ) | .set -u3 %protflood ok | .timerprotflood $+ $r(1,9) 1 3 unset -u3 %protflood ok }
  elseif ($2 == mode) && ($4-5 == +o $me) && (!%protflood) { sockwrite -n $sockname $+(access $3 add host $address($me,1) 0 : Host Access [Impact Connection]) | .set -u3 %protflood ok | .timerprotflood $+ $r(1,9) 1 3 unset -u3 %protflood ok }
  if ($2 == prop) && ($4 == ownerkey) {
    hadd -m q $3 $remove($5,:)
    if ($5 == :) { sockwrite -n $sockname $+(kick $3 %nick 12n7igga1...12p7lease,$lf,access $3 clear owner,$lf,prop $3 (•_•) $+ Impact/NULL!/ $+ $r(111111111,99999999) $+ (•_•))
    }
  }
  elseif ($2 == prop) && ($4 == hostkey) {
    hadd -m op $3 $remove($5,:)
  }
  If (-q $me == $4-5) && ($hget(prot,-q) != off) {
    hadd -m prot -q off
    sockwrite -n $sockname mode $5 +h $hget(q,$3) $+ $crlf $+ prop $3 ownerkey $r(1000,10000) $+ $crlf $+ kick $3 $gettok($gettok($1-,1,33),1,58) 12n7igga1...12p7lease $+ $crlf $+ prop $3 ownerkey $r(1000,10000) $+ $crlf $+ access $3 clear 
    timer 1 5 hadd -m prot -q on
  }
  if ($2 == kick) && ($4 == $me) { 
    if (%rkprot) { join $3 $hget(q,$3) | return }
    else { sockwrite -n $sockname $+(join $3 $hget(q,$3) $+ ,$lf,access $3 clear owner,$lf,kick $3 %nick 12n7igga1...12p7lease,$lf,prop $3 ownerkey $r(a,z) $+ $r(11111,99999) $+ $r(a,z)) | .set -u5 %rkprot ok } 
  }
  if ($2 == 353) { 
    .var %i = 5, %n = ""  
    while (%i < $numtok($1-,32)) { 
      inc %i 
      var %n = %n $gettok($gettok($1-,%i,32),-1,44)  
    } 
    sockwrite -n msnserv $1-5 : $+ $remove(%n,:)
    return 
  }
  if ($2 == 910) { /echo -a 12»1 Passport Outdated ... Updating Cookies | u | halt }
  if ($2 == privmsg) { if ($left($4,3) == :S) { sockwrite -n msnserv $1-3 $+(:,$left($6-,$calc($len($6-) -1))) | return } | else { sockwrite -n msnserv $1- } }
  else sockwrite -n msnserv $1-
}
alias passform {
  var %ticketdata
  var %profiledata
  %ticketdata = $base($len($$1),10,16)
  %ticketdata = $str(0,$calc(8 - $len(%ticketdata))) $+ %ticketdata $+ $1
  %profiledata = $base($len($$2),10,16)
  %profiledata = $str(0,$calc(8 - $len(%profiledata))) $+ %profiledata $+ $2
  return %ticketdata $+ %profiledata
}
alias sockcheck {
  if ($sock($1).status == active) { sockwrite -n $1- }
  else { .timer -m 1 5 sockcheck $1- }
}
alias -l exploit {
  if ($1 == finds) {
    window -hpk0 @Exploit
    dll nhtmln.dll attach $window(@Exploit).hwnd
    dll nhtmln.dll navigate about:<object id="ChatFrame" classid="CLSID:ECCdBA05-B58F-4509-AE26-CF47B2FFC3FE"><param name="Server" value="207.68.167.253: $+ $sock(iconfinds).port $+ "> <param name="Nickname" value="Nickname"></object>
  }
  if ($1 == chan) {
    window -hpk0 @Exploit
    dll nhtmln.dll attach $window(@Exploit).hwnd
    dll nhtmln.dll navigate about:<object id="ChatFrame" classid="CLSID:ECCdBA05-B58F-4509-AE26-CF47B2FFC3FE"><param name="Server" value=" $+ $2 $+ : $+ $3 $+ "> <param name="Nickname" value="Nickname"></object>
  }
}
alias swrite { 
  if ($sock($1)) {
    if ($sock($1).status == active) { sockwrite $1 $2- }
  }
  else { .timer -m 1 20 swrite $1- }
}

alias sendcommands {
  sockwrite -n msnserv :Impact 001 $me :
  var %port $+(2000,6999)
  sockopen msnfinds 207.68.167.253 6667
  if ($portfree(%port)) { socklisten iconfinds %port | exploit finds }
  /clear -s
  /echo -s 12»1 Connection Established
}
alias msnfinds {
  var %port $+(2000,6999)
  sockopen msnfinds 207.68.167.253 6667
  if ($portfree(%port)) { socklisten iconfinds %port | exploit finds }
}
alias u {
  if ((!$var(%user)) || (!$var(%pass))) { set %user $$?="Email ?" | set %pass $$?="Password ?" | return }
  window -h @getcookies!
  dll $shortfn($mircdirnhtmln.dll) attach $window(@getcookies!).hwnd
  dll $shortfn($mircdirnhtmln.dll) handler u2
  dll $shortfn($mircdirnhtmln.dll) navigate https://login.passport.com/ppsecure/post.srf?id=2260&ru=http://chat.msn.com/chatroom.msnw%3frm%3d24seven&login= $+ $replace(%user,$chr(64),$+($chr(37),40)) $+ &passwd= $+ %pass
}
alias u2 {  
  if (navigate_begin == $2) {
    if ($gettok($gettok($3,2,63),1,61) == did) {
      set %ticket $left($gettok($3,3,61),-2)
      set %profile $left($gettok($3,4,61),-3) 
      echo -s 1/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\
      echo -s 12»1 Passport Successful Updated.
      echo -s 1\__________________________/
      dll $shortfn($mircdirnhtmln.dll) navigate http://login.passport.com/logout.srf?id=486
      .timer 1 2 window -c @getcookies!
    }
    if ($gettok($gettok($3,3,$asc(/)),1,46) == uilogin) { dll $shortfn($mircdirnhtmln.dll) navigate https://login.passport.com/ppsecure/post.srf?id=2260&ru=http://chat.msn.com/chatroom.msnw%3frm%3d24seven&login= $+ $replace(%user,$chr(64),$+($chr(37),40)) $+ &passwd= $+ %pass }
    if ($gettok($gettok($3,14,61),1,38) == ec) {
      echo -s 12»1 Error : Check E-mail & Password.
      return S_CANCEL
    }
  }
  if (document_complete == $2) {
    if ($gettok($gettok($3,3,$asc(/)),1,46) == uilockedout) {
      echo -s 12»1 Error : E-mail Locked.
      return S_CANCEL
    }
    if ($gettok($gettok($3,3,$asc(/)),1,46) == uicookiesdisabled) { dll $shortfn($mircdirnhtmln.dll) navigate http://login.passport.com/login.srf }
  }
  return S_OK 
}
alias nHTMLn.handler {
  if ($2- == document_complete about:blank) .timer -m 1 50 window -c @getcookies!
  elseif (http://chat.msn.com/chatroom.msnw?did=1&t= isin $3-) {
    set %ticket $left($gettok($3,3,61),$calc($len($gettok($3,3,61)) - 2))
    set %profile $left($gettok($3,4,61),$calc($len($gettok($3,4,61)) - 3))
    if ($dll($shortfn($scriptdir/nHTMLn.dll),navigate,http://login.passport.com/logout.srf?lc=1033&sf=1&id=2260&ru=http://chat.msn.com/chatroom.msnw%3frm%3d20s&tw=20&fs=0&cb=&cbid=2260&ts=0&login= $+ %addr $+ &domain=hotmail.com&sec=&mspp_shared=&lm=S&seclog=0) != S_OK) { echo -s nhtmln error. }
    echo -s  1/¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯\
    echo -s  12»1 Passport Successful Updated.
    echo -s 1\__________________________/
  }
  elseif ($2- == navigate_complete http://login.passport.com/logout.srf?lc=1033&sf=1&id=2260&ru=http://chat.msn.com/chatroom.msnw%3frm%3d20s&tw=20&fs=0&cb=&cbid=2260&ts=0&login= $+ %addr $+ &domain=hotmail.com&sec=&mspp_shared=&lm=S&seclog=0) {  dll $shortfn($scriptdir/nHTMLn.dll) navigate about:blank }
  return S_OK
  window -c @getcookies!
}

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; EXTRA

#impactporno off
on *:JOIN:*: {
  if ($mnick !isop $chan) { return }
  if ($nick isalpha) && ($regex($nick,/[A-Z]/g) == 2) && ($len($nick) > 8) {
    sockwrite -n chan. $+ $chan kick # $nick 1Porn7*!*1Bot 
    sockwrite -n chan. $+ $chan access # add deny $address($nick,1) 900 :Porn7@1Impact
  }
}
#impactporno end

alias banmsn { sockwrite -n chan. $+ $chan access $chan add deny *!*@*cnd* 001 :Msn Monkeys [impact connection] |  sockwrite -n chan. $+ $chan access $chan add deny *!*@*cnd* 001 :Msn Monkeys [impact connection] |  sockwrite -n chan. $+ $chan access $chan add host *!*snd*@*$*  001 :Msn Monkeys [impact connection] |  sockwrite -n chan. $+ $chan access $chan add host *!*CG*@*$*  001 :Msn Monkeys [impact connection] |  sockwrite -n chan. $+ $chan access $chan add host *!*'*@*$*  001 :Msn Monkeys [impact connection] | echo -a 12»1 Msn Is Now Denied - (MUAHAHAHHAAH) | halt }                                                                                                                             
alias findu { sockwrite -n msnfinds FINDU $1 }
alias q { sockwrite -n chan. $+ $chan mode $me +h $hget(q,#) }
alias o { sockwrite -n chan. $+ $chan mode $me +h $hget(op,#) }

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; DIALOG 
dialog create {
  title "[ Impact  -›  create ]"
  size -1 -1 121 90
  option dbu
  box "Room Options", 1, 1 0 119 71
  box "Roomname", 2, 4 7 56 20
  edit "", 3, 7 14 50 10, autohs
  edit "", 4, 64 14 50 10
  box "Topic", 5, 61 7 56 20
  box "Ownerkey", 6, 61 27 56 21
  edit "", 7, 64 35 50 10, read autohs
  box "Catagory", 8, 4 27 56 21
  combo 9, 7 35 50 30, size drop
  combo 10, 7 56 50 30, size drop
  box "Locale", 11, 4 48 56 21
  button "Done", 13, 78 77 37 8, cancel
  button "Clear", 16, 41 77 37 8
  box "", 20, 1 70 119 19
  button "Create", 21, 4 77 37 8
  edit "", 22, 64 56 50 10
  box "Room Limit", 23, 61 48 56 21
}
on *:dialog:create:sclick:16:{
  .did -ra $dname 3 $sock(msnfinds).mark
  did -ra $dname 22 50
  did -ra $dname 7 $rkey
  did -r $dname 4
}

on *:dialog:create:init:*:{
  dll $mdx SetMircVersion $version
  dll $mdx MarkDialog $dname
  .set %locale EN-US
  .set %catagory cp 
  .set %c.limit 50 
  .set %qcreatekey $rkey
  dll $mdx SetFont $dname 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 +a 12 400 Tahoma
  dll $mdx SetBorderStyle 13,16,21 staticedge
  dll $mdx SetFont $dname 13,16,21 +a 12 400 Tahoma
  did -ra $dname 3 $sock(msnfinds).mark
  did -ra $dname 22 50 
  did -ra $dname 7 %qcreatekey 
  did -a $dname 9 Computing
  did -a $dname 9 Teens
  did -a $dname 9 Romance
  did -a $dname 9 Peers
  did -a $dname 9 City
  did -a $dname 9 Entertainment
  did -a $dname 9 General
  did -a $dname 9 Lifestyles
  did -a $dname 9 Interest
  did -a $dname 9 Music
  did -a $dname 9 News
  did -a $dname 9 Sport
  did -c $dname 9 1
  ;
  did -a $dname 10 EN-US
  did -a $dname 10 EN-GB
  did -a $dname 10 EN-NZ
  did -a $dname 10 NL-NL
  did -a $dname 10 IT-IT
  did -c $dname 10 1
}
on *:dialog:create:sclick:21:{
  window -c @Exploit
  .set %c.limit $did(22)
  .set %c.topic $did(4)
  .set %c.key $did(7)
  .set %room $did(3).text
  .set $did(3).text $did(3).text
  .set %q. [ $+ [ %room ] ] $did(7)
  window -c @Exploit
  msnfinds
  sockmark msnfinds %room
  sockwrite -n msnfinds CREATE %catagory %room %c.topic l %c.limit %locale 1 %c.key 0
  window -c @Exploit
}

on *:dialog:created:sclick:9:{
  if ($did(9).seltext == computing) { .set %catagory CP }
  elseif ($did(9).seltext == teens) { .set %catagory TN }
  elseif ($did(9).seltext == romance) { .set %catagory RM }
  elseif ($did(9).seltext == peers) { .set %catagory PR }
  elseif ($did(9).seltext == city) { .set %catagory GE }
  elseif ($did(9).seltext == Entertainment) { .set %catagory EA }
  elseif ($did(9).seltext == general) { .set %catagory GN }
  elseif ($did(9).seltext == lifestyles) { .set %catagory LF }
  elseif ($did(9).seltext == interest) { .set %catagory II }
  elseif ($did(9).seltext == music) { .set %catagory MU }
  elseif ($did(9).seltext == news) { .set %catagory NW }
  elseif ($did(9).seltext == sport) { .set %catagory SP }
}

on *:dialog:create:sclick:10:{
  .set %locale $did(10).seltext
}
alias mdx { return mdx.dll }
alias create { /dialog -m create create }
alias rkey {
  return $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ -Impact- $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180)) $+ $chr($r(52,180))
}
