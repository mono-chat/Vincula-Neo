;;;Userlist V2 by Sky;;;

;;;;;Event's

on *:LOAD:{
  ;;oldvers check
  if ($exists(Lists.ini)) { remove Lists.ini }
  writeini -n Userlist.ini Global Halted False
}

on *:JOIN:#:{
  if ($GetGlobalStatus == False) {

    if ($IsGlobal($ial($nick).addr) == True) {

      var %level = $GetLevel(Global,$ial($nick).addr)
      var %comment = $GetComment(Global,$ial($nick).addr)
      if (%level != k) && (%level != b) {
        msg # Global %level User $nick ( $+ %comment $+ )
        $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove(#,$chr(37)) $nick %level
      }
      elseif (%level == k) {
        sockwrite $hget(channels,#) $+(kick # $nick :,%comment,$crlf)
      }
      elseif (%level == b) {
        sockwrite $hget(channels,#) $+(access # add deny $ial($nick).addr,$lf,kick # $nick :,%comment,$crlf)           
      }

    }
    elseif ($IsChan(#,$ial($nick).addr) == True) && ($IsHalted(#) == False) && ($IsHalted(#,$ial($nick).addr) == False) {

      var %level = $GetLevel(#,$ial($nick).addr)
      var %comment = $GetComment(#,$ial($nick).addr) 
      if (%level != k) && (%level != b) {
        msg # Local %level User $nick ( $+ %comment $+ )
        $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove(#,$chr(37)) $nick %level
      }
      elseif (%level == k) {
        sockwrite $hget(channels,#) $+(kick # $nick :,%comment,$crlf)
      }
      elseif (%level == b) {
        sockwrite $hget(channels,#) $+(access # add deny $ial($nick).addr,$lf,kick # $nick :,%comment,$crlf)           
      }

    }
    elseif ($MatchWildCard(#)) {
      var %ifmatchchan = $chr(37) $+ $ifmatch
      if ($IsChan(%ifmatchchan,$ial($nick).addr) == True) && ($IsHalted(%ifmatchchan) == False) && ($IsHalted(%ifmatchchan,$ial($nick).addr) == False) {
        var %level = $GetLevel(%ifmatchchan,$ial($nick).addr)
        var %comment = $GetComment(%ifmatchchan,$ial($nick).addr)
        if (%level != k) && (%level != b) {
          msg # Local %level User $nick ( $+ %comment $+ )
          $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove(#,$chr(37)) $nick %level
        }
        elseif (%level == k) {
          sockwrite $hget(channels,#) $+(kick # $nick :,%comment,$crlf)
        }
        elseif (%level == b) {
          sockwrite $hget(channels,#) $+(access # add deny $ial($nick).addr,$lf,kick # $nick :,%comment,$crlf)           
        }
      }
    }
  }
}


;;;;;Alias's

;;;;;;;User Entries

;Format
;[%#Room\bName/Global]
;Gate=Level,Halted,Comment
;Halted=True/False
;[WildCard]
;ShortForm=LongForm

alias -l AddWildCard {
  writeini -n Userlist.ini WildCard $1 $2
}

alias -l RemWildCard {
  remini Userlist.ini WildCard $1
}

alias -l MatchWildCard {
  ;Format
  ;RoomName
  var %i = 1
  while (%i <= $ini(Userlist.ini,WildCard,0)) {
    if ($ini(Userlist.ini,WildCard,%i) isin $1) {
      return $readini(Userlist.ini,WildCard,$ifmatch)
      %i = $ini(Userlist.ini,WildCard,0)
    }
    inc %i
  }
}

alias -l AddLocalUser {
  writeini -n Userlist.ini $1 $2 $+($3,$chr(44),False,$chr(44),$4-)
  if ($readini(Userlist.ini,$1,Halted) == $null) { writeini -n Userlist.ini $1 Halted False }
  DoLocalAction $1 $2 $3 $4-
}

alias -l RemLocalUser {
  remini -n Userlist.ini $1 $2
}

alias -l RemChannel {
  remini -n Userlist.ini $1
}

alias -l HaltChannel {
  writeini -n Userlist.ini $1 Halted True
}

alias -l HaltGlobal {
  writeini -n Userlist.ini Global Halted True
}

alias -l AddGlobalUser {
  writeini -n Userlist.ini Global $1 $+($2,$chr(44),False,$chr(44),$3-)
  DoGlobalAction $1 $2 $3-
}

alias -l RemGlobalUser {
  remini Userlist.ini Global $1
}

alias -l DoGlobalAction {
  var %nick = $ial(*! $+ $1).nick
  var %i = 1
  while (%i <= $chan(0)) {
    var %z = 1
    while (%z <= $nick($chan(%i),0)) {
      if ($nick($chan(%i),%z) == %nick) {
        if ($2 != k) && ($2 != b) {
          msg $chan(%i) Global $2 User %nick ( $+ $3- $+ )
          $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove($chan(%i),$chr(37)) %nick $2
        }
        elseif ($2 == k) {
          if ($me isowner #) || ($me isop #) {
            sockwrite $hget(channels,$chan(%i)) $+(kick $chan(%i) %nick :,$3-,$crlf)
          }
        }
        elseif ($2 == b) {
          if ($me isowner #) || ($me isop #) {
            sockwrite $hget(channels,$chan(%i)) $+(access $chan(%i) add deny $1,$lf,kick $chan(%i) %nick :,$3-,$crlf)
          }
        }
      }
      inc %z
    }
    inc %i
  }
}

alias -l DoLocalAction {
  var %nick = $ial(*! $+ $2).nick
  if ($3 != k) && ($3 != b) {
    msg $1 Local $3 User %nick ( $+ $4- $+ )
    $+(.timer,$rand(a,z),$rand(a,z),$rand(a,z),modeup) 1 2 SetModeStatus $remove($1,$chr(37)) %nick $3
  }
  elseif ($3 == k) {
    sockwrite $hget(channels,$chan(%i)) $+(kick $1 %nick :,$4-,$crlf)
  }
  elseif ($3 == b) {
    sockwrite $hget(channels,$chan(%i)) $+(access $1 add deny $1,$lf,kick $1 %nick :,$4-,$crlf)
  }
}

alias -l GetGlobalStatus {
  return $readini(Userlist.ini,Global,Halted)
}

alias -l GetRoomStatus {
  return $readini(Userlist.ini,$1,Halted)
}

alias -l IsGlobal {
  ;  echo -a $readini(Userlist.ini,Global,$1) $1
  if ($readini(Userlist.ini,Global,$1) != $null) { return True }
  else { return False }
}

alias -l IsChan {
  if ($readini(Userlist.ini,$1,$2) != $null) { return True }
  else { return False }
}

alias -l IsHalted {

  if ($gettok($readini(Userlist.ini,Global,$1),2,44) == False) { return False }
  elseif ($readini(Userlist.ini,$1,Halted) == False) { return False }
  elseif ($gettok($readini(Userlist.ini,$1,$2),2,44) == False) { return False }
}

alias -l GetLevel {

  return $gettok($readini(Userlist.ini,$1,$2),1,44)

}

alias -l GetComment {

  return $gettok($readini(Userlist.ini,$1,$2),3,44)

}

alias -l GetGLevel {
  var %level = $GetLevel(Global,$1) 
  if (%level == q) { return Owner }
  if (%level == o) { return Host }
  if (%level == v) { return Voice }
  if (%level == k) { return Kick }
  if (%level == b) { return Banlist }
}

alias -l GetLLevel {
  var %level = $GetLevel($2,$1) 
  if (%level == q) { return Owner }
  if (%level == o) { return Host }
  if (%level == v) { return Voice }
  if (%level == k) { return Kick }
  if (%level == b) { return Banlist }
}

alias SetModeStatus {
  ;Format
  ;Room Nick Level
  mode $chr(37) $+ $1 $+(+,$3) $2
}

alias IsOnUserList {
  if ($readini(Userlist.ini,$2,$1) != $null) { return True }
  elseif ($readini(Userlist.ini,Global,$1) != $null) { return True }
}

alias AltList {
  writeini -n Userlist.ini $1 $2 $+($gettok($readini(Userlist.ini,$2,$1),2,44),$chr(44),$3,$chr(44),$gettok($readini(Userlist.ini,$2,$1),3,44))
}

alias AltComment {
  writeini -n Userlist.ini $1 $2 $+($gettok($readini(Userlist.ini,$1,$2),1-2,44),$chr(44),$3-)
}


alias -l msn.decode {
  var %r, %l 1
  %r = $replace($1-,ï‚,B,ï‚ ,-,ï€>,-,ï€‹,-,ï€,-,ï…,E,ïƒ,C,ï,A,ï’,R,ï‹,K,ï¹,y,ïº˜,i,ïº‰,s,ï¬³,t,ï¬¸,u,ï»‰,e,ï«,k,ï†,F,ïµ,u,ï§,g,Î§,X,ï€¾,>,ï€¥,$chr(37),ï€¸,8,ï¤,d,ï­,m,ï¨,h,ï»›,s,ï‡,G,ï,M,ï¬,l,ï³,s,ïŸ,_,ï”,T,ï²,r,ï¡,a,ï®,n,ï£,c,ï¥,e,ï,N,ï¡,a,ï´,t,ï©,i,ï¯,o,ï®,n,ï¦,f,ï·,w,ïœ,\,ï¼,|,ï€,@,ï,P,ï„,D,ï€§,',ï€ , ,ï€¨,$chr(40),ï€©,$chr(41),ï€ª,*,ï€º,:,ï›,[,ï,],ï°,p,ï€®,.)
  %r = $replace(%r,Ï‡,X,Å†,n,Î©,n,»·,y,Ñ€,p,Ğ ,P,Å™,r,Ñ…,x,Ä®,I,Ä»,L,Ğ¤,o,Äˆ,C,Å,o,Å©,u,Å„,n,Ä¢,G,Å•,r,Å›,s,Ä·,k,Å–,R,×–,i,Îµ,e,×§,r,Ñ›,h,Ğ¼,m,ØŒ,·,Ä«,i,â€˜,‘,â€™,’,Û±,',Ä“,e,Â¢,¢,ï“,S,â€¢,•,ï,O,ï‰,I,Î†,A,ÑŠ,b,ŠÏ,T,Î¦,o,Ğ‚,b,Ñ,r,Ğ,E,Ğ´,A,Ğš,K,Ä,D,Ğ¸,n,Î¸,o,Ğœ,M,Ğ‡,I,Ğ¢,T,Ğ„,e,Çº,A,Ã¶,ö,Ã¤,ä,â€“,–,Â·,·,Ã–,Ö,Ãœ,Ü,Ã‹,Ë,Ñ•,s,Ä…,a,Ä­,i,Ğ¹,n,Ğ²,b,Ğ¾,o,Ñˆ,w,Ä,G,Ä‘,d,Ğ·,e,Å¦,T,Î±,a,ÄŸ,g,Ãº,ú,Å”,R,Ä„,A,Ä‡,c,Ä,Ğ,Îš,K,Ñ,y,Âµ,µ,Ã,Í,â€¹,‹,Â¦,¦,Ã•,Õ,Ã™,Ù,Ã€,À,Î ,N,Ò“,f,Î°,u,Ä¿,L,Å,o,Ï‚,c,Ä‹,c,Ä§,h,Ä¯,i,Å§,t,Î–,Z,Ã,Ş,Ã¾,ş,Ã§,ç,Ã¡,á,Â¾,¾,Å¾,,Ã‡,Ç,Â $+ $chr(173),-,Ã,Á,â€¦,…,Â¨,¨,Ã½,ı,Ë‰,¯,â€,”,Ã›,Û,Ã¬,ì,Ï,p,Î­,e,Ğ³,r,Ã ,à,Ãˆ,È,Â¼,¼,Äµ,j,Ã£,ã,Ä™,e,ÅŸ,s,Âº,º,Ã‘,Ñ,Ã£,ã,Ã†,Æ,Ëš,°,Ğ¯,R,Ëœ,˜,Ã,Î,ÃŠ,Ê,Ã,İ,Ã,Ï,Ã‰,É,â€¡,‡,ÃŒ,Ì,Âª,ª,Ã³,ó,â„¢,™,Ã’,Ò,Ã­,í,Â¿,¿,Ã„,Ä,Â¶,¶,Ã¼,ü,Æ’,ƒ,Ã°,ğ,Ã²,ò,Ãµ,õ,Â¡,¡,Ã©,é,ÃŸ,ß,Â¤,¤,Ã—,×,Ã´,ô,Å ,Š,Ã¸,ø,â€º,›,Ã¢,â,Ã®,î,â‚¬,€,Å¡,š,Ã¯,ï,Ã¿,ÿ,Åƒ,N,Â©,©,Â®,®,Ã»,û,â€ ,†,Â°,°,Â§,§,Â±,±,Â²,²,Ã¨,è)
  %r = $replace(%r,Å‡,N,Û°,·,Ä´,J,Ğ†,I,Î£,E,Î¹,i,Å,O,Î´,o,×¥,y,Î½,v,×¢,y,×,n,Å½,,Å‘,o,ÄŒ,C,Ä—,e,â‚¤,L,ÅŒ,O,Î¬,a,Ä ,G,â„¦,O,Ğ,H,á»ƒ,e,áºµ,a,Ğ–,K,á»,e,áº¿,e,á»—,o,Å«,u,â‚£,F,âˆ†,a,áº®,A,á»§,u,Ä¶,K,Å¤,T,Å,S,Î˜,O,Ğ¨,W,Î’,B,ĞŸ,N,áº…,w,ï»¨,i,ï¯¼,s,ÑŸ,u,Ñ’,h,Â¹,¹,á»²,Y,Î»,a,Ğ¡,C,Ğ $+ $chr(173),E,Å°,U,Äª,I,Ä,c,Ä”,E,Åœ,S,á»Š,I,Ä,g,Å€,l,Ñ—,i,Ù­,*,Å‰,n,Ä¦,H,Ğ”,A,Îœ,M,Ñ‘,e,Ğ¦,U,Ñ,e,â€œ,“,Ñ„,o,Ñƒ,y,Ñ,c,Ğº,k,Ã…,Å,Æ¤,P,â„,R,ï “,I,É³,n,Ê—,c,â–«,·,Ñ“,r,á»‡,e,áº¯,a,áº³,a,Å¯,u,Ä½,L,Æ°,u,Î‡,·,Ë™,',Î·,n,â„“,l,Â,,Â,,Â,,×€,i,Ä¡,g,Å´,W,Î”,A,ï®Š,J,Î¼,µ,Å¸,Ÿ,Ä¥,h,Î²,ß,Ğ¬,b,Å³,u,Ñ”,e,Ï‰,w,ÄŠ,C,Ñ–,i,Å‚,l,Ç¿,o,âˆ«,s,Å¼,z,Å£,t,Ã¦,æ,â‰ˆ,=,Å,L,Å‹,n,Ú¯,S,Ä,d,Ïˆ,w,Ïƒ,o,Ä£,g,Î‰,H,Î,i,Ò‘,r,Îº,k,ÅŠ,N,œ,\,ï€¯,/,Â¬,¬,Ñ‰,w,Û•,o,×,o,Â³,³,Â½,½,Ä°,I,Ä¾,l,Ä•,e,Å¢,T,Å,s,Å·,y,Ä¾,l,Ä©,i,Ã”,Ô,Åš,S,Ä¹,L,Ğ°,a,Ğµ,e,Î¡,P,Ğˆ,J,Î,N,Ç»,a,Ñ’,h,Î®,n,Î¯,l,Å’,Œ,Â¯,¯,Ä,a,Åµ,w,Ã‚,Â,Ãƒ,Ã,Ğ½,H,Ë‡,',Â¸,¸,Ì£,$chr(44),Ø·,b,Ã“,Ó,Ğ™,N,Â«,«,Ã¹,ù,Ã˜,Ø,Ãª,ê)
  %r = $replace(%r,Ø§,I,Ğ»,n,Ñ‹,bl,Ğ±,6,×©,w,â€•,-,Îª,I,ï ,`,Å­,u,á»•,o,Ç¾,Ø,áº«,a,áº§,a,ï±,q,áº‚,W,Ä¤,H,á»,o,âˆ’,-,ï,^,à¸¥,a,Äœ,G,ïº¯,j,Ù‰,s,Ğƒ,r,á»©,u,â—,·,Ï,u,ï€°,0,ï€·,7,ï€¢,",Ó©,O,Ç,i,Ç‘,O,Æ ,O,ï€²,2,Ò¯,y,ï¶,v,Ğ,A,â‰¤,<,â‰¥,>,áº©,a,ïˆ,H,Ù¤,e,ïº‚,i,ĞŒ,K,Åª,U,ï€»,;,Äƒ,a,Ä¸,k,Ä†,C,Ä¬,I,Åˆ,n,Ä¨,I,Î™,I,Î«,Y,ïŠ,J,ï˜,X,ï½,$chr(125),ï»,$chr(123),Î,E,Ë†,^,ï–,V,ïŒ,L,Î³,y,ïº,i,Î,o,á»³,y,Ä†,C,Ä¬,I,Ä¸,k,Å¶,y,à¹›,c,á»¡,o,à¹“,m,ïº„,i,ï­,G,Å¬,U,Ä’,E,Ä‚,A,Ã·,÷,Â , ,â€š,‚,â€,„,Ë†,ˆ,â€°,‰,Äƒ,a,ï¸,x,ï€½,=,Ù‚,J,ï€¿,?,ï¿¼,-,â—Š,o,Ñ‚,T,Ä€,A,ï­‡,P,Ä–,E,Ä˜,E,Î¿,o,Ï‹,u,â€¼,!!,×˜,u,ï®’,S,Ğ§,y,Ò,r,Ä›,e,Ä˜,E,Äº,I,Î›,a,Î¿,o,Ãš,Ú,Å˜,R,Æ¯,U,Å“,œ,ï€­,-,â€”,—,à¸«,n,à¸ª,a,à¸,s,Î¨,Y,áºª,A,Ï€,n,Å…,N,Ø!,o,Ğ‹,h,á»£,o,Ä‰,c,â—¦,·,ï®,S,Å²,U,Ğ•,E,Ğ…,S,Ûµ,o,ÙŠ,S,Ø¨,u,Ø©,o,Ø¦,s,Ä¼,l,Ä±,i,Å—,r,Ğ¶,x,Î…,",Ï,w,â–ª,·,Î¶,l,Ğ©,W,à¸¿,B,á»¹,y,ÏŠ,i,Å¥,t,Ğ¿,n,Â´,´,Ú©,s,ï±¢,*,Î¾,E,Ñœ,k,âˆš,v,Ï„,t,Ã,Ğ,Â£,£,Ã±,ñ,Â¥,¥,Ã«,ë,Ã¥,å,ï™,Y,Ç,a)
  %r = $replace(%r,áº±,a,â€‚, ,ÎŸ,O,â‚ª,n,áº¬,A,ï‚£,£,ïƒ ,à,ï‚®,®,ïƒ¡,á,ï‚©,©,ïƒµ,õ,á»,o,â€, ,Ö±,¸,Ö¾,-,ï¬´,n,Åº,z,â€Œ, ,Ù,',à¹˜,c,à¸…,m,Â,,ï€¼,<,â–¼,v,ï»œ,S,â„®,e,Åº,z,áº­,a,à¹‘,a,ï¬,fi,ÑŒ,b,ïº’,.,ïºœ,:,à¸¨,a,à¸ ,n,à¹,o,à¸°,=,ï­†,y,à¸‹,i,â€¾,¯,âˆ‚,a,ï¼š,:,â‰ ,=,ï€«,+,Ù…,r,á»“,o,á»¬,U,Ğ›,N,Ó’,A,á»Œ,O,áº„,W,á»´,Y,ïºš,u,ïº¬,i,ïº,u,Å»,Z,ï®•,S,ïº³,w,ï¯½,u,ïº±,uw,ï»š,J,ïº”,a,ï€¡,!,á»…,e,Ù„,J,Ø±,j,Ù€,_,ÏŒ,o,â‚«,d,â„–,no,á»¯,u,Äš,E,Ï†,o,ï» ,I,Ñ†,u,ïƒ…,A,ïƒ‘,N,ĞŠ,H,Îˆ,E,ï¾,~,ï•,U,áº¡,a,ï€±,1,ï€´,4,ï€³,3,á»‰,i,Î•,E,Ğ,U,Ùƒ,J,â˜…,*,ï¢,b,ï€£,$chr(35),ï€¤,$,â—‹,o,Ñ,10,á»µ,y,áº,w,Ò›,k,Ù¿,u,â™‚,o,ï­Š,n,Ù¥,o,ï®,S,â¿,n,ï»—,9,ï¢,b,ï€£,$chr(35),ï€¤,$,â—‹,o,Ñ,10,á»‹,i,Î‘,A,â€€, ,ï»©,o,ï»,E,Ù†,u,áº½,e,Ø«,u,ã…“,t,Ó›,e,Ó˜,E,ï»˜,o,Û·,v,ï¬ª,w,á»¥,u,Å,O,Â,,á»±,u,ï¼ª,J,ï½…,e,ï½,a,ï¼®,N,ï¼ˆ,$chr(40),ï¼ ,@,ï½€,`,ï¼,.,â€²,',ï¼‰,$chr(41),â–¬,-,â—„,<,â–º,>,âˆ‘,E,Ö»,$chr(44),â€¬,|,â€,|,â€ª,|,â€«,|,á»˜,O,Ğ˜,N,ï—,W,ïº,z)
  %r = $replace(%r,×¡,o,â•³,X,Ù ,·,Ò’,F,Ï…,u,â€,,Ö¼,·,Ç”,u,à¸œ,w,áº°,A,áº¤,A,Â»,»,ïº–,u,á»‘,o,ï®“,S,á»Ÿ,o,ïº•,u,ï®”,S, Òœ,K,â™¦,·,â€—,_,ï»ˆ,b,à¸¬,w,ï¬°,x,ï‚­,-,à¸‚,u,à¸—,n,á»œ,O,áº¶,A,á»­,u,á»„,E,à¨¹,J, Ù‡,o,â– ,·,Æ¡,o,ï¿,,Ò£,h,Òš,K,Ò²,X,Ò³,x,Òœ,K,Ø¹,E,Ú†,c,Ñ‡,y,Ğ¥,X,Ù¦,7,Ö½,.,Ù,',Ö¿,',×ƒ,:,á»,o,Ò–,X,ÛŒ,s,à¸¬,w,âˆ™,·,Î¤,T,â“’,c,â“,a,â“Ÿ,p,â“”,e,â“£,t,Ç,A,Ğ¥,X,Ö³,.,ÛŒ,s,á»ˆ,I,Ì‰,',ïš,Z,á»,o,áº¹,e,Ò,k,ïº–,u,á»‘,o,ï®“,S,á»Ÿ,o,ïº•,u,Òš,K,ïš,Z,Ì•,',â”œ,|,â”¤,|,Ø£,I,Â‹,,×,x,áº·,a,Ç’,o,á»œ,O,â˜¼,¤,×,.,ïš,Z,à¸¤,n,â‘·,4,â‘µ,2,â’ª,0,à¹€,i)
  return %r
}

alias -l matchlist {
  ;ial,level
  if ($IsGlobal($1) == true) {
    if ($getglev($1) == $3) { return $style(1) }
  }
  else {
    if ($getllev($1,$2) == $3) { return $style(1) }
  }
}

menu nicklist {
  -
  Userlist
  . $+ $iif($IsOnUserList($ial($snicks).addr,$active) == True,Properties,$null)
  .. $+ $iif($IsGlobal($ial($snicks).addr) == true,Global Level $getglev($ial($snicks).addr),Local Level $getllev($ial($snicks).addr,$active))
  ... $+ $matchlist($ial($snicks).addr,$active,owner) $+ Owner:{ $iif($IsGlobal($ial($snicks).addr) == true,$AltList(Global,$ial($snicks).addr,q),$AltList($active,$ial($snicks).addr,q)) }
  ...Host:{ $iif($IsGlobal($ial($snicks).addr) == true,$AltList(Global,$ial($snicks).addr,o),$AltList($active,$ial($snicks).addr,o)) }
  ...Voice:{ $iif($IsGlobal($ial($snicks).addr) == true,$AltList(Global,$ial($snicks).addr,v),$AltList($active,$ial($snicks).addr,v)) }
  ...Kick:{ $iif($IsGlobal($ial($snicks).addr) == true,$AltList(Global,$ial($snicks).addr,k),$AltList($active,$ial($snicks).addr,k)) }
  ...Banlist:{ $iif($IsGlobal($ial($snicks).addr) == true,$AltList(Global,$ial($snicks).addr,b),$AltList($active,$ial($snicks).addr,b)) }
  ..Comment:{ $iif($IsGlobal($ial($snicks).addr) == true,$AltComment(Global,$ial($snicks).addr,$$?"Please enter in a comment."),$AltComment($active,$ial($snicks).addr,$$?"Please enter in a comment.")) }
  ..Remove:{ RemGlobalUser $ial($snicks).addr | RemLocalUser $active $ial($snicks).addr }
  .Global
  ..Add
  ...Owner:{ var %com = $$?"Please enter in a comment" | AddGlobalUser $ial($snicks).addr q $iif(%com == $null,Reason Unspecified,%com) }
  ...Host:{ var %com = $$?"Please enter in a comment" | AddGlobalUser $ial($snicks).addr o $iif(%com == $null,Reason Unspecified,%com) }
  ...Voice:{ var %com = $$?"Please enter in a comment" | AddGlobalUser $ial($snicks).addr v $iif(%com == $null,Reason Unspecified,%com) }
  ...Kick:{ var %com = $$?"Please enter in a comment" | AddGlobalUser $ial($snicks).addr k $iif(%com == $null,Reason Unspecified,%com) }
  ...Banlist:{ var %com = $$?"Please enter in a comment" | AddGlobalUser $ial($snicks).addr b $iif(%com == $null,Reason Unspecified,%com) }
  ..Remove:{ RemGlobalUser $ial($snicks).addr }
  .Local
  ..Add
  ...Owner:{ var %com = $$?"Please enter in a comment" | AddLocalUser $active $ial($snicks).addr q $iif(%com == $null,Reason Unspecified,%com) }
  ...Host:{ var %com = $$?"Please enter in a comment" | AddLocalUser $active $ial($snicks).addr o $iif(%com == $null,Reason Unspecified,%com) }
  ...Voice:{ var %com = $$?"Please enter in a comment" | AddLocalUser $active $ial($snicks).addr v $iif(%com == $null,Reason Unspecified,%com) }
  ...Kick:{ var %com = $$?"Please enter in a comment" | AddLocalUser $active $ial($snicks).addr k $iif(%com == $null,Reason Unspecified,%com) }
  ...Banlist:{ var %com = $$?"Please enter in a comment" | AddLocalUser $active $ial($snicks).addr b $iif(%com == $null,Reason Unspecified,%com) }
  ..Remove:{ RemLocalUser $active $ial($snicks).addr }
  .Control
  ..Main:{ ShowUserList }
  ..Halted:{ echo -a to be made }
  . $+ $iif($len($replace($remove(#,$+($chr(37),$chr(35))),\b,$chr(32))) > 30,$mid($replace($remove(#,$+($chr(37),$chr(35))),\b,$chr(32)),1,30) $+ ...,$replace($remove(#,$+($chr(37),$chr(35))),\b,$chr(32)))
  ..$submenu($getulistchans($1))
}

alias -l getulistchans {
  if ($1 == begin) { return - }
  if ($1 <= $ini(Userlist.ini,$active,0)) { return $ial(*! $+ $ini(Userlist.ini,$active,$1)).nick $+ :RemLocalUser $active $ini(Userlist.ini,$active,$1) }
  if ($1 == end) { return - }
}

dialog Userlist {
  title "Userlist V2"
  size -1 -1 216 145
  option dbu
  box "Lists", 1, 1 0 213 105
  list 2, 4 7 206 95, size
  button "Add New", 3, 1 107 37 11
  check "Wildcard", 4, 5 128 34 10
  edit "", 5, 41 128 101 10
  button "Remove", 6, 39 107 37 11
  box "", 7, 1 120 144 23
  combo 8, 148 123 65 19, size drop
  combo 9, 78 107 136 35, size drop
}

alias ShowUserlist { 
  if ($dialog(Userlist)) { dialog -v Userlist | halt }
  dialog -m Userlist Userlist 
}

alias RefreshList {
  if ($dialog(Userlist)) { 
    var %i = 1

  }
}
